<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agricultural Product Price Prediction</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .info-text {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }

        .btn-predict {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-predict:active {
            transform: translateY(0);
        }

        .btn-predict:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-card {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card.show {
            display: block;
        }

        .price-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .price-label {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .price-value {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .price-range {
            font-size: 0.95em;
            color: #666;
            margin-top: 10px;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .detail-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .detail-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .suggestion-box {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .suggestion-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .suggestion-text {
            color: #555;
            line-height: 1.6;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .model-info {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .model-info h3 {
            color: #333;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .price-value {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŒ¾ Agricultural Product Price Predictor</h1>
            <p>Get AI-powered price predictions for your agricultural products</p>
        </div>

        <div class="content">
            <form id="predictionForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="product">Product *</label>
                        <select id="product" required>
                            <option value="">Select Product</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quality">Quality Grade *</label>
                        <select id="quality" required>
                            <option value="">Select Quality</option>
                            <option value="Premium">Premium</option>
                            <option value="Grade A">Grade A</option>
                            <option value="Grade B">Grade B</option>
                            <option value="Grade C">Grade C</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quantity">Quantity (kg) *</label>
                        <input type="number" id="quantity" min="1" step="0.01" required>
                        <span class="info-text">Enter quantity in kilograms</span>
                    </div>

                    <div class="form-group">
                        <label for="region">Region *</label>
                        <select id="region" required>
                            <option value="">Select Region</option>
                            <option value="North">North</option>
                            <option value="South">South</option>
                            <option value="East">East</option>
                            <option value="West">West</option>
                            <option value="Central">Central</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="month">Month *</label>
                        <select id="month" required>
                            <option value="">Select Month</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="season">Season *</label>
                        <select id="season" required>
                            <option value="">Select Season</option>
                            <option value="Winter">Winter</option>
                            <option value="Summer">Summer</option>
                            <option value="Monsoon">Monsoon</option>
                            <option value="Autumn">Autumn</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="demand">Market Demand Index *</label>
                        <input type="number" id="demand" min="1" max="10" step="0.1" required>
                        <span class="info-text">Scale: 1 (Low) to 10 (High)</span>
                    </div>

                    <div class="form-group">
                        <label for="supply">Market Supply Index *</label>
                        <input type="number" id="supply" min="1" max="10" step="0.1" required>
                        <span class="info-text">Scale: 1 (Low) to 10 (High)</span>
                    </div>

                    <div class="form-group">
                        <label for="rainfall">Rainfall (mm) *</label>
                        <input type="number" id="rainfall" min="0" max="500" step="0.1" required>
                        <span class="info-text">Average monthly rainfall</span>
                    </div>

                    <div class="form-group">
                        <label for="temperature">Temperature (Â°C) *</label>
                        <input type="number" id="temperature" min="0" max="50" step="0.1" required>
                        <span class="info-text">Average temperature</span>
                    </div>

                    <div class="form-group">
                        <label for="transport">Transport Cost (â‚¹/kg) *</label>
                        <input type="number" id="transport" min="0" max="50" step="0.1" required>
                        <span class="info-text">Cost per kg to transport</span>
                    </div>

                    <div class="form-group">
                        <label for="storage">Storage Days *</label>
                        <input type="number" id="storage" min="0" max="90" required>
                        <span class="info-text">Days in storage</span>
                    </div>
                </div>

                <button type="submit" class="btn-predict" id="predictBtn">
                    Predict Price
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px;">Analyzing market data...</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="result-card" id="resultCard">
                <div class="price-display">
                    <div class="price-label">Predicted Price</div>
                    <div class="price-value">â‚¹<span id="priceValue">0</span>/kg</div>
                    <div class="price-range">
                        Range: â‚¹<span id="priceLower">0</span> - â‚¹<span id="priceUpper">0</span> per kg
                    </div>
                </div>

                <div class="result-details">
                    <div class="detail-item">
                        <div class="detail-label">Total Price</div>
                        <div class="detail-value">â‚¹<span id="totalPrice">0</span></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Quantity</div>
                        <div class="detail-value"><span id="quantityDisplay">0</span> kg</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Model Accuracy (MAE)</div>
                        <div class="detail-value">Â±â‚¹<span id="mae">0</span></div>
                    </div>
                </div>

                <div class="suggestion-box">
                    <div class="suggestion-title">ðŸ’¡ Pricing Suggestion</div>
                    <div class="suggestion-text" id="suggestionText"></div>
                </div>
            </div>

            <div class="model-info">
                <h3>About This Model</h3>
                <p>This AI model uses Random Forest algorithm trained on thousands of agricultural product records. 
                It considers multiple factors including product quality, market demand, supply conditions, weather patterns, 
                and regional variations to provide accurate price predictions. The model helps farmers make informed decisions 
                about pricing their products competitively.</p>
            </div>
        </div>
    </div>

    <script>
        // Load products on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });

        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const data = await response.json();
                
                const productSelect = document.getElementById('product');
                data.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product;
                    option.textContent = product;
                    productSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Hide previous results and errors
            document.getElementById('resultCard').classList.remove('show');
            document.getElementById('errorMessage').classList.remove('show');
            
            // Show loading
            document.getElementById('loading').classList.add('show');
            document.getElementById('predictBtn').disabled = true;
            
            // Collect form data
            const formData = {
                product: document.getElementById('product').value,
                quality: document.getElementById('quality').value,
                quantity_kg: parseFloat(document.getElementById('quantity').value),
                region: document.getElementById('region').value,
                month: parseInt(document.getElementById('month').value),
                season: document.getElementById('season').value,
                demand_index: parseFloat(document.getElementById('demand').value),
                supply_index: parseFloat(document.getElementById('supply').value),
                rainfall_mm: parseFloat(document.getElementById('rainfall').value),
                temperature_celsius: parseFloat(document.getElementById('temperature').value),
                transport_cost: parseFloat(document.getElementById('transport').value),
                storage_days: parseInt(document.getElementById('storage').value)
            };
            
            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Display results
                    document.getElementById('priceValue').textContent = data.predicted_price_per_kg.toFixed(2);
                    document.getElementById('priceLower').textContent = data.confidence_interval.lower.toFixed(2);
                    document.getElementById('priceUpper').textContent = data.confidence_interval.upper.toFixed(2);
                    document.getElementById('totalPrice').textContent = data.total_price.toFixed(2);
                    document.getElementById('quantityDisplay').textContent = data.quantity_kg.toFixed(2);
                    document.getElementById('mae').textContent = data.model_accuracy.mae.toFixed(2);
                    document.getElementById('suggestionText').textContent = data.suggestion;
                    
                    document.getElementById('resultCard').classList.add('show');
                } else {
                    // Show error
                    document.getElementById('errorMessage').textContent = data.error || 'An error occurred';
                    document.getElementById('errorMessage').classList.add('show');
                }
            } catch (error) {
                document.getElementById('errorMessage').textContent = 'Network error: ' + error.message;
                document.getElementById('errorMessage').classList.add('show');
            } finally {
                // Hide loading
                document.getElementById('loading').classList.remove('show');
                document.getElementById('predictBtn').disabled = false;
            }
        });
    </script>
</body>
</html>
